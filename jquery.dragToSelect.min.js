//http://creativecommons.org/licenses/by/3.0/ http://andreaslagerkvist.com/jquery/drag-to-select/ https://github.com/pykiss/jQuery.dragToSelect
(function(a){jQuery.fn.dragToSelect=function(b){var c=jQuery(this),d=c;do{if(/auto|scroll|hidden/.test(d.css("overflow")))break;d=d.parent()}while(d[0].parentNode);if(b=="disable")return d.addClass(f.disabledClass),this;if(b=="enable")return d.removeClass(f.disabledClass),this;var e=typeof b=="object"?b:{},f=jQuery.extend({className:"jquery-drag-to-select",classSelecting:"jquery-drag-to-select-selecting",activeClass:"active",disabledClass:"disabled",selectedClass:"selected",scrollTH:10,percentCovered:25,selectables:!1,autoScroll:!1,selectOnMove:!1,onShow:function(){return!0},onHide:function(){return!0},onRefresh:function(){return!0}},e),g=d.offset(),h={left:g.left,top:g.top,width:d.outerWidth(),height:d.outerHeight()},i={left:0,top:0},j=jQuery("<div/>").appendTo(d).attr("class",f.className).css("position","absolute"),k=function(a){if(d.is("."+f.disabledClass))return;i.left=a.pageX-h.left+d[0].scrollLeft,i.top=a.pageY-h.top+d[0].scrollTop;var b={left:i.left+"px",top:i.top+"px",width:"1px",height:"1px"};j.addClass(f.activeClass).css(b),f.onShow()},l=function(a){if(!j.is("."+f.activeClass)||d.is("."+f.disabledClass))return;var b=a.pageX-h.left+d[0].scrollLeft,c=a.pageY-h.top+d[0].scrollTop,e=b,g=c,k=i.left-e,l=i.top-g;b>i.left&&(e=i.left,k=b-i.left),c>i.top&&(g=i.top,l=c-i.top);var m={left:e+"px",top:g+"px",width:k+"px",height:l+"px"};j.css(m),f.onRefresh()},m=function(a){if(!j.is("."+f.activeClass)||d.is("."+f.disabledClass))return;f.onHide(j)!==!1&&j.removeClass(f.activeClass)},n=function(a){if(!j.is("."+f.activeClass)||d.is("."+f.disabledClass))return;a.pageY+f.scrollTH>h.top+h.height&&(d[0].scrollTop+=f.scrollTH),a.pageY-f.scrollTH<h.top&&(d[0].scrollTop-=f.scrollTH),a.pageX+f.scrollTH>h.left+h.width&&(d[0].scrollLeft+=f.scrollTH),a.pageX-f.scrollTH<h.left&&(d[0].scrollLeft-=f.scrollTH)},o=function(){if(!j.is("."+f.activeClass)||d.is("."+f.disabledClass))return;var b=c.find(f.selectables),e=j.offset(),g={left:e.left,top:e.top,width:j.width(),height:j.height()};b.each(function(b){var c=a(this),d=c.offset(),e={left:d.left,top:d.top,width:c.width(),height:c.height()};p(g,e)>f.percentCovered?c.addClass(f.selectedClass):c.removeClass(f.selectedClass)})},p=function(a,b){if(a.left<=b.left&&a.top<=b.top&&a.left+a.width>=b.left+b.width&&a.top+a.height>b.top+b.height)return 100;a.right=a.left+a.width,a.bottom=a.top+a.height,b.right=b.left+b.width,b.bottom=b.top+b.height;var c=Math.max(a.left,b.left),d=Math.min(a.right,b.right),e=Math.max(a.top,b.top),f=Math.min(a.bottom,b.bottom);if(f>=e&&d>=c){var g=(d-c)*(f-e)/(b.width*b.height)*100;return g}return 0};j.mousemove(function(a){l(a),f.selectables&&f.selectOnMove&&o(),f.autoScroll&&n(a),a.preventDefault()}).mouseup(function(a){f.selectables&&o(),m(a),a.preventDefault()}),jQuery.fn.disableTextSelect&&d.disableTextSelect();var q=function(a){g=d.offset(),h={left:g.left,top:g.top,width:d.outerWidth(),height:d.outerHeight()},l(a),f.selectables&&f.selectOnMove&&o(),f.autoScroll&&n(a),a.preventDefault()},r=function(b){f.selectables&&o(),m(b),a(document.body).off("mousemove",q),a(document.body).off("mouseup",r),d.removeClass(f.classSelecting),b.preventDefault()};return d.mousedown(function(b){if(b.which!=1)return;g=d.offset(),h={left:g.left,top:g.top,width:d.outerWidth(),height:d.outerHeight()};if(b.pageX-h.left+d.scrollLeft()>d.innerWidth()||b.pageY-h.top+d.scrollTop()>d.innerHeight())return;d.addClass(f.classSelecting),a("."+f.className).length<=0&&(j=jQuery("<div/>").appendTo(d).attr("class",f.className).css("position","absolute")),a(document.body).on("mousemove",q),a(document.body).on("mouseup",r),k(b),b.preventDefault()}),this}})(jQuery);
